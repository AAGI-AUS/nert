---
title: "Use nert to augment agricultural analytics with SMIPS data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Use nert to augment agricultural analytics with SMIPS data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
```

The TERN Soil Moisture Integration and Prediction System (SMIPS) generates
useful measurements of soil moisture at 1km resolution across all of Australia.
TERN provides this soil moisture information as packaged daily datasets [via
their TERN Data Portal](https://data.tern.org.au/model-derived/smips/), in
cloud-optimised GeoTIFF format. The **nert** package provides ease of access
to these SMIPS datasets for use and inclusion in R data analytics workflows.

This document introduces you to the **nert** package, including setup and
how to use the package to download SMIPS data for given locational coordinates
in Australia. The document then showcases an example of a grain production
experiment, and how we can use **nert** and the SMIPS soil moisture readings
to improve our analytics and modelling.

TODO: below. Vignette is a work-in-progress.

## Setup: Acquire and link your TERN API key

details and screenshots for this here. 

At end: include a quick example of how to
grab the data similar to what Adam had in the readme (e.g., just download
data for Adelaide CBD or something and show how it appears in the data frame).

```{r setup}
library(nert)

# ...
```


## A synthetic dataset for a grain production experiment

details here. Just create the data here and include as a (properly documented)
dataset in /data, but briefly summarise here the
method for how it was created as per Max's email.

Final paragraph: draw attention to the sites and their lat/long coordinates,
this leads nicely into the next bit.

## Download SMIPS data for the sites across times

detail + code for that here, mostly as it appears in the files Max sent in
the emails. Add comments, and note that we are using the
percentage dataset (i.e., SMIndex) rather than the totalbucket (check with 
Max: is this the best way? Do things change too much for the worse if we
just use the default totalbucket?)

## A simple model for grain yield

The first model, without SMIPS. Include Max's DAGs (as jpgs?) as figures. As
per the email Max sent.

## Augment the yield model with soil moisture data

The second model, including the SMIPS soil moisture as a confounder. As per
Max's email, we perhaps expect phenomenologically that soil moisture improves 
yield, but reduces the effect of Nitrogen in the soil due to volatilisation.
modeling shows that this is the case.
