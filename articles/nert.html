<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>nert • nert</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="nert">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nert</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/nert.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/nert_for_agricultural_analytics.html">Using nert to augment agricultural analytics with SMIPS data</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/AAGI-AUS/nert/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>nert</h1>
                        <h4 data-toc-skip class="author">Adam H.
Sparks</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/AAGI-AUS/nert/blob/main/vignettes/nert.Rmd" class="external-link"><code>vignettes/nert.Rmd</code></a></small>
      <div class="d-none name"><code>nert.Rmd</code></div>
    </div>

    
    
<!-- STOP! Do not edit this file. This file is generated from nert.Rmd.orig -->
<p>The TERN Soil Moisture Integration and Prediction System (SMIPS)
generates useful measurements of soil moisture at 1km resolution across
all of Australia. TERN provides this soil moisture information as
packaged daily datasets <a href="https://data.tern.org.au/model-derived/smips/" class="external-link">via their TERN Data
Portal</a>, in cloud-optimised GeoTIFF (COG) format. The {nert} package
provides ease of access to these SMIPS datasets for use and inclusion in
R data analytics workflows. This can be obtained by registering at <a href="https://portal.tern.org.au" class="external-link uri">https://portal.tern.org.au</a>, or by more simply using
<code><a href="../reference/get_key.html">nert::get_key()</a></code> in your R session. This document introduces
you to the {nert} package, including setup and how to use the package to
download SMIPS data.</p>
<div class="section level2">
<h2 id="acquiring-your-tern-api-key">Acquiring Your TERN API Key<a class="anchor" aria-label="anchor" href="#acquiring-your-tern-api-key"></a>
</h2>
<p>An API key is required to access TERN datasets (including SMIPS)
through their online data portal. The {nert} package streamlines the
data process, but still requires authorisation using an API key.
However, it is straightforward to sign up to the TERN Data Portal and
acquire an API key that you can use, and by setting it in your R
environment (via <code>.Renviron</code>) you can provide the {nert}
package with that credential to allow convenient access.</p>
<p>The following steps detail the process for signing in to your TERN
account, generating an API key, and storing it in your R
environment.</p>
<ol style="list-style-type: decimal">
<li>Either directly navigate to the TERN Data Discovery Portal (<a href="https://portal.tern.org.au/" class="external-link uri">https://portal.tern.org.au/</a>) in a web browser OR use
<code><a href="../reference/get_key.html">nert::get_key()</a></code> to launch a web browser at the TERN website
and click the “Sign In” button that appears in the top-right of the
browser window.</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://aagi-aus.github.io/nert/">nert</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_key.html">get_key</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="01-get-started.jpg" style="width:80.0%"></p>
<ol start="2" style="list-style-type: decimal">
<li>
<p>Click the Australian Access Federation button to sign in to the
TERN Data Portal via your University ID (or alternatively, sign in via
CILogon or your Google identity).</p>
<p><img src="02-get-started.jpg" style="width:80.0%"></p>
</li>
<li>
<p>Once signed in, click on the menu in the top-right with your name
and click the “TERN Account” entry to open your account profile.</p>
<p><img src="03-get-started.jpg" style="width:80.0%"></p>
</li>
<li>
<p>On your account profile screen, navigate to the menu on the
left-hand side, and click the “Create API key” entry.</p>
<p><img src="04-get-started.jpg" style="width:80.0%"></p>
</li>
<li>
<p>On this screen you can create your API key for accessing the TERN
Data Portal. Give your key whatever name you like (e.g., below I have
called the key “my_API_key” for demonstration purposes), and then click
the “Request API Key” button.</p>
<p><img src="05-get-started.jpg" style="width:80.0%"></p>
</li>
<li>
<p>Your API key is now generated and appears as the string of text
inside the text box on the page, together with the key’s creation and
expiration dates. Copy the API key to your clipboard, be sure not to
close this browser window until after you have successfully stored the
key locally somewhere as you won’t see it again.</p>
<p><img src="06-get-started.jpg" style="width:80.0%"></p>
</li>
</ol>
</div>
<div class="section level2">
<h2 id="saving-your-api-key-locally">Saving Your API Key Locally<a class="anchor" aria-label="anchor" href="#saving-your-api-key-locally"></a>
</h2>
<div class="section level3">
<h3 id="using-your--renviron-file">Using Your .Renviron File<a class="anchor" aria-label="anchor" href="#using-your--renviron-file"></a>
</h3>
<p>There are a few options for saving your key locally. The most
straightforward way is to save it directly into your
<code>.Renviron</code> file. The most secure way is to store it in your
system’s keychain using the <a href="https://keyring.r-lib.org/index.html" class="external-link">{keyring}</a> package.</p>
<p>Following, I will demonstrate how to save your API key in your
<code>.Renviron</code> file and also, optionally, your operating
system’s credentials store for more security.</p>
<ol style="list-style-type: decimal">
<li>Open your <code>.Renviron</code> file. An easy way to open the right
file is to use the {usethis} package in your R session, <em>e.g.</em>,
<code><a href="https://usethis.r-lib.org/reference/edit.html" class="external-link">usethis::edit_r_environ()</a></code>. Add a new line to the file to
store your API key in the variable <code>TERN_API_KEY</code>, ensuring
to use that name as that is what {nert} will automatically look
for:</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>    <span class="va">TERN_API_KEY</span><span class="op">=</span><span class="st">'&lt;paste your key here&gt;'</span></span></code></pre></div>
<pre><code>![](07-get-started.jpg){width=80%}</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>
<p>Save your <code>.Renviron</code> file, and restart your R session
so that the change is applied. You can then test that the {nert} package
is reading your API key properly by entering
<code><a href="../reference/get_key.html">nert::get_key()</a></code> at the R command console. If the API key
was successfully read by {nert}, then you should see your API key appear
verbatim as output.</p>
<p><img src="08-get-started.jpg" style="width:80.0%"></p>
</li>
<li><p>Finally, you can quickly test that the data download from the
TERN portal is working as intended by downloading a test data raster.
The below code downloads the SMIPS “totalbucket” soil moisture data
raster for January 1st, 2024, and uses the {terra} package’s
<code><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">terra::extract()</a></code> function to get a point value for the soil
moisture measurement at the Adelaide CBD (at approximately -34.9285
decimal degrees latitude, 138.6007 longitude):</p></li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://aagi-aus.github.io/nert/">nert</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.8.21</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'terra'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:knitr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     spin</span></span>
<span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_smips.html">read_smips</a></span><span class="op">(</span>day <span class="op">=</span> <span class="st">"2024-01-01"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">r</span>, xy <span class="op">=</span> <span class="cn">TRUE</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>lon <span class="op">=</span> <span class="fl">138.6007</span>, lat <span class="op">=</span> <span class="op">-</span><span class="fl">34.9285</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   ID smips_totalbucket_mm_20240101        x         y</span></span>
<span><span class="co">#&gt; 1  1                      46.07692 138.6037 -34.93254</span></span></code></pre></div>
<p>At this stage your {nert} package is now working, and you can use it
to easily download SMIPS datasets from the TERN Data Portal.</p>
</div>
<div class="section level3">
<h3 id="using-the-keyring-package-for-secure-storage">Using the {keyring} Package for Secure Storage<a class="anchor" aria-label="anchor" href="#using-the-keyring-package-for-secure-storage"></a>
</h3>
<p>If you prefer a more secure method, you can use the <a href="https://keyring.r-lib.org/index.html" class="external-link">{keyring}</a> package to
store your API key in your system’s credential store. If you don’t have
the {keyring} package installed, you can install it with:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"keyring"</span><span class="op">)</span></span></code></pre></div>
<p>Once it’s installed, you can store your API key with:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://keyring.r-lib.org/" class="external-link">keyring</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://keyring.r-lib.org/reference/has_keyring_support.html" class="external-link">keyring_create</a></span><span class="op">(</span><span class="st">"nert"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add the key to your OS's credential store</span></span>
<span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_set</a></span><span class="op">(</span><span class="st">"NERT_API_KEY"</span>, keyring <span class="op">=</span> <span class="st">"nert"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># verify that the key was stored properly</span></span>
<span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">"NERT_API_KEY"</span>, keyring <span class="op">=</span> <span class="st">"nert"</span><span class="op">)</span></span></code></pre></div>
<p>Where <code>NERT_API_KEY</code> is the name of the key you want to
store in the keyring. You will enter the actual key value you copied
from the TERN website when {keyring} prompts you to do so.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://aagi-aus.github.io/nert/">nert</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://keyring.r-lib.org/" class="external-link">keyring</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_smips.html">read_smips</a></span><span class="op">(</span></span>
<span>  day <span class="op">=</span> <span class="st">"2024-01-01"</span>,</span>
<span>  api_key <span class="op">=</span> <span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">"NERT_API_KEY"</span>, keyring <span class="op">=</span> <span class="st">"nert"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Note that here we specified a value for the API key.</p>
<p>Using the example from above, you can get the SMIPS data for all of
Australia on Jan 1, 2024 like so:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://aagi-aus.github.io/nert/">nert</a></span><span class="op">)</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_smips.html">read_smips</a></span><span class="op">(</span>day <span class="op">=</span> <span class="st">"2024-01-01"</span><span class="op">)</span></span></code></pre></div>
<p>Note that {nert} re-exports <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">tidyterra::autoplot</a></code> for ease
of visulalising the TERN data.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;SpatRaster&gt; resampled to 501270 cells.</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="test-plot-1.png" alt="A plot of SMIPS data for all of Australia on 2024-01-01."><p class="caption">
A plot of SMIPS data for all of Australia on 2024-01-01.
</p>
</div>
<p>Repeating an example from above where we tested if the API key works,
if you wish to fetch only data for a single point or points, you can
specify them like this using the data object, <code>r</code>, from
above, which is much quicker than fetching the entire dataset:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">r</span>, xy <span class="op">=</span> <span class="cn">TRUE</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>lon <span class="op">=</span> <span class="fl">138.6007</span>, lat <span class="op">=</span> <span class="op">-</span><span class="fl">34.9285</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   ID smips_totalbucket_mm_20240101        x         y</span></span>
<span><span class="co">#&gt; 1  1                      46.07692 138.6037 -34.93254</span></span></code></pre></div>
<p>That’s it, you’re all set!</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Adam H. Sparks, Wasin Pipattungsakul, Russell Edson, Sam Rogers, Max Moldovan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
